# **ğŸš¢ Lighthouse GraphQL Framework**

[English](https://github.com/light-speak/lighthouse/blob/main/README.md) | [ä¸­æ–‡](https://github.com/light-speak/lighthouse/blob/main/README_zh.md)

[![CI](https://github.com/light-speak/lighthouse/actions/workflows/main.yml/badge.svg)](https://github.com/light-speak/lighthouse/actions/workflows/main.yml)
[![codecov](https://codecov.io/gh/light-speak/lighthouse/branch/main/graph/badge.svg)](https://codecov.io/gh/light-speak/lighthouse)
[![Go Report Card](https://goreportcard.com/badge/github.com/light-speak/lighthouse)](https://goreportcard.com/report/github.com/light-speak/lighthouse)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

`Lighthouse` æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„è‡ªç ” GraphQL æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–åŸºäºå¾®æœåŠ¡æ¶æ„çš„ GraphQL æœåŠ¡å¼€å‘ã€‚æ¡†æ¶é›†æˆäº†æ—¥å¿—ç³»ç»Ÿï¼ˆä½¿ç”¨ `zeroLog`ï¼‰ï¼Œæ”¯æŒ Elasticsearchã€æ–‡ä»¶æ—¥å¿—æ¨¡å¼å’Œ Redis ç¼“å­˜ï¼ŒåŒæ—¶å…·æœ‰çµæ´»çš„æŒ‡ä»¤ç³»ç»Ÿå’Œå¼ºå¤§çš„è‡ªå®šä¹‰é…ç½®èƒ½åŠ›ã€‚æ¡†æ¶ç›®å‰å†…ç½®å¯¹ `gorm` çš„æ”¯æŒï¼Œæœªæ¥è¿˜å°†æ‰©å±•æ›´å¤šçš„ ORM é€‰é¡¹ã€‚

## ç‰¹æ€§

- **å¾®æœåŠ¡æ¶æ„æ”¯æŒ**ï¼šé‡‡ç”¨ç‹¬ç«‹çš„å¾®æœåŠ¡æ¨¡å¼ï¼Œä¸æ”¯æŒ GraphQL Federationï¼Œè€Œæ˜¯é€šè¿‡è‡ªå®šä¹‰çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥ç®¡ç†å¾®æœåŠ¡ã€‚
- **è‡ªå®šä¹‰æŒ‡ä»¤**ï¼šæ”¯æŒä¸°å¯Œçš„è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œå¯ä»¥å®ç°åŠ¨æ€æŸ¥è¯¢ã€è¿‡æ»¤ã€å…³è”ç­‰æ“ä½œã€‚
- **å¯æ‰©å±•æ€§**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ”¯æŒå¤šç§ GraphQL æ–‡ä»¶ç»“æ„ï¼Œçµæ´»æ»¡è¶³ä¸åŒé¡¹ç›®éœ€æ±‚ã€‚
- **ORM é›†æˆ**ï¼šç›®å‰æ”¯æŒ `gorm`ï¼Œæœªæ¥ä¼šå¢åŠ å¯¹æ›´å¤š ORM åº“çš„æ”¯æŒã€‚
- **æ—¥å¿—ä¸ç¼“å­˜é›†æˆ**ï¼šé›†æˆäº† `zeroLog` æ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒ Elasticsearchã€æ–‡ä»¶æ—¥å¿—å’Œ Redis ç¼“å­˜ã€‚

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

1. **ä½¿ç”¨ `go install` å®‰è£…**

   ```bash
   go install github.com/light-speak/lighthouse@latest
   ```

2. **åˆ›å»ºæ–°é¡¹ç›®**

   ```bash
   lighthouse generate:init
   ```

### é…ç½®æ–‡ä»¶ (lighthouse.yml)

`lighthouse.yml` æ˜¯ `lighthouse` çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®š GraphQL Schema è·¯å¾„ã€æ–‡ä»¶æ‰©å±•åã€ORM è®¾ç½®ç­‰ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹é…ç½®ï¼š

```yaml
# lighthouse.yml

schema:
  ext:
    - graphql       # æ”¯æŒçš„æ–‡ä»¶æ‰©å±•å
    - graphqls
  path:
    - schema        # GraphQL Schema æ–‡ä»¶æ‰€åœ¨è·¯å¾„
  model:
    orm: gorm       # ORM é…ç½®ï¼Œå½“å‰æ”¯æŒ gorm
```

- `schema.ext`ï¼šæŒ‡å®š Schema æ–‡ä»¶çš„æ‰©å±•åï¼Œå¯ä»¥æ˜¯ `.graphql` æˆ– `.graphqls`ã€‚
- `schema.path`ï¼šå®šä¹‰ Schema æ–‡ä»¶çš„è·¯å¾„ï¼Œæ¡†æ¶å°†è‡ªåŠ¨åŠ è½½è¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚
- `model.orm`ï¼šå½“å‰æ”¯æŒ `gorm` ä½œä¸º ORM åº“ã€‚

### ç›®å½•ç»“æ„

`example` é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```plaintext
.
â”œâ”€â”€ cmd                     # CLI ç›¸å…³ä»£ç 
â”‚   â”œâ”€â”€ cmd.go              # ä¸»å‘½ä»¤å…¥å£
â”‚   â”œâ”€â”€ migrate
â”‚   â”‚   â””â”€â”€ migrate.go      # æ•°æ®åº“è¿ç§»é€»è¾‘
â”‚   â””â”€â”€ start
â”‚       â””â”€â”€ start.go        # å¯åŠ¨æœåŠ¡å…¥å£
â”œâ”€â”€ models                  # æ•°æ®æ¨¡å‹ç›¸å…³å®šä¹‰
â”‚   â”œâ”€â”€ enum.go             # æšä¸¾ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ input.go            # è¾“å…¥ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ interface.go        # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ model.go            # æ¨¡å‹ç»“æ„
â”‚   â””â”€â”€ response.go         # å“åº”æ•°æ®ç»“æ„
â”œâ”€â”€ repo                    # æ•°æ®åº“æ“ä½œå°è£…
â”‚   â””â”€â”€ repo.go
â”œâ”€â”€ resolver                # GraphQL è§£æå™¨
â”‚   â”œâ”€â”€ mutation.go         # Mutation è§£æ
â”‚   â”œâ”€â”€ query.go            # Query è§£æ
â”‚   â””â”€â”€ resolver.go         # Resolver ä¸»å…¥å£
â”œâ”€â”€ schema                  # GraphQL Schema æ–‡ä»¶
â”‚   â””â”€â”€ user.graphql        # ç¤ºä¾‹ Schema æ–‡ä»¶
â””â”€â”€ service                 # æœåŠ¡é€»è¾‘
    â””â”€â”€ service.go
```

### æ¥ä¸‹æ¥æ­¥éª¤

åœ¨ `schema` ç›®å½•ä¸‹å¡«å…¥è‡ªå®šä¹‰çš„ `schema` æ–‡ä»¶ï¼Œ

### ä½¿ç”¨æŒ‡ä»¤

åœ¨ `lighthouse` ä¸­ï¼Œä½ å¯ä»¥åœ¨ GraphQL Schema ä¸­ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š

- **@skip / @include**ï¼šæ¡ä»¶æŸ¥è¯¢æŒ‡ä»¤ï¼Œç”¨äºåŠ¨æ€æ§åˆ¶å­—æ®µæ˜¯å¦åŒ…å«åœ¨å“åº”ä¸­ã€‚
- **@enum**ï¼šç”¨äºå®šä¹‰æšä¸¾ç±»å‹å­—æ®µï¼Œç›®å‰åªæ”¯æŒ `int8` ç±»å‹ã€‚
- **@paginate / @find / @first**ï¼šç”¨äºåˆ†é¡µã€æŸ¥æ‰¾å’Œè·å–ç¬¬ä¸€ä¸ªç»“æœçš„æŸ¥è¯¢ã€‚
- **@in / @eq / @neq / @gt / @gte / @lt / @lte / @like / @notIn**ï¼šç”¨äºå‚æ•°è¿‡æ»¤çš„æŒ‡ä»¤ï¼Œæ”¯æŒå„ç§æ¯”è¾ƒè¿ç®—ç¬¦ã€‚
- **@belongsTo / @hasMany / @hasOne / @morphTo / @morphToMany**ï¼šå…³ç³»æ˜ å°„æŒ‡ä»¤ï¼Œç”¨äºå®šä¹‰æ¨¡å‹ä¹‹é—´çš„å…³ç³»ã€‚
- **@index / @unique**ï¼šä¸ºå­—æ®µåˆ›å»ºç´¢å¼•æˆ–æ·»åŠ å”¯ä¸€çº¦æŸã€‚
- **@defaultString / @defaultInt**ï¼šä¸ºå­—æ®µè®¾ç½®é»˜è®¤å€¼ã€‚
- **@tag**ï¼šç”¨äºæ ‡è®°å­—æ®µçš„é™„åŠ å±æ€§ã€‚
- **@model**ï¼šæ ‡è®°ç±»å‹ä¸ºæ•°æ®åº“æ¨¡å‹ã€‚
- **@softDeleteModel**ï¼šæ ‡è®°ç±»å‹ä¸ºæ•°æ®åº“æ¨¡å‹ï¼Œå¹¶æ”¯æŒè½¯åˆ é™¤åŠŸèƒ½ã€‚
- **@order**ï¼šç”¨äºå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºã€‚
- **@cache**ï¼šç”¨äºç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚

### ç¤ºä¾‹ä»£ç 

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹æŸ¥è¯¢ï¼Œåœ¨è·å–ç”¨æˆ·æ•°æ®æ—¶ä½¿ç”¨äº† `@paginate` æŒ‡ä»¤è¿›è¡Œåˆ†é¡µï¼š

```graphql
type Query {
  users: [User] @paginate(scopes: ["active"])
}

type User @model(name: "UserModel") {
  id: ID!
  name: String!
  age: Int
  posts: [Post] @hasMany(relation: "Post", foreignKey: "user_id")
}
```

### ç”Ÿæˆä»£ç 

```bash
lighthouse generate:schema
```

### æ•°æ®åº“è¿ç§»

```bash
go run . app:migrate
```

### è¿è¡ŒæœåŠ¡

```bash
go run . app:start
```

## æ‰©å±•ä¸è‡ªå®šä¹‰

`lighthouse` æä¾›äº†çµæ´»çš„æ‰©å±•æ¥å£ï¼Œä½ å¯ä»¥ï¼š

- **æ·»åŠ è‡ªå®šä¹‰æŒ‡ä»¤**ï¼šç¼–å†™è‡ªå·±çš„æŒ‡ä»¤æ¥æ‰©å±•æ¡†æ¶çš„åŠŸèƒ½ã€‚
- **æ”¯æŒå…¶ä»– ORM**ï¼šå‚è€ƒ `gorm` é›†æˆæ–¹å¼ï¼Œæ·»åŠ å¯¹å…¶ä»– ORM åº“çš„æ”¯æŒã€‚

## å¼€å‘è®¡åˆ’

| ğŸš€ åŠŸèƒ½åˆ†ç±»    | âœ¨ åŠŸèƒ½æè¿°                                          | ğŸ“… çŠ¶æ€  |
| -------------- | -------------------------------------------------- | -------- |
| ğŸ› ï¸ è‡ªå®šä¹‰æŒ‡ä»¤  | æ·»åŠ è‡ªå®šä¹‰æŒ‡ä»¤çš„æ”¯æŒ                                | âœ… å·²å®Œæˆ  |
| ğŸ“Š æŸ¥è¯¢æŒ‡ä»¤    | æ·»åŠ  @find å’Œ @first æ³¨è§£ä»¥æ”¯æŒæŸ¥è¯¢åŠŸèƒ½             | âœ… å·²å®Œæˆ  |
| ğŸ” æŸ¥è¯¢ä¸è¿‡æ»¤   | æ·»åŠ æ—¥æœŸèŒƒå›´è¿‡æ»¤æŒ‡ä»¤                                | âœ… å·²å®Œæˆ  |
|                | æ·»åŠ å­—ç¬¦ä¸²åŒ¹é…æŒ‡ä»¤                                  | âœ… å·²å®Œæˆ  |
|                | æ·»åŠ åŠ¨æ€æ’åºæŒ‡ä»¤                                    | âœ… å·²å®Œæˆ  |
| ğŸ“Š åˆ†é¡µæŒ‡ä»¤    | æ·»åŠ  @paginate æ³¨è§£ä»¥æ”¯æŒåˆ†é¡µåŠŸèƒ½                   | âœ… å·²å®Œæˆ  |
| ğŸ“œ æ¡ä»¶æŸ¥è¯¢æŒ‡ä»¤ | æ·»åŠ  @skip å’Œ @include æ¡ä»¶æŸ¥è¯¢æŒ‡ä»¤                | ğŸš§ è¿›è¡Œä¸­  |
| ğŸ“š å…³ç³»æ˜ å°„æŒ‡ä»¤ | æ·»åŠ  @morphTo, @morphToMany, @hasOne, @manyToMany  | ğŸš§ è¿›è¡Œä¸­  |
| ğŸ”§ å¾®æœåŠ¡ç®¡ç†   | æ·»åŠ å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒ                                  | â³ è®¡åˆ’ä¸­  |
| ğŸ’¾ ç¼“å­˜é›†æˆ    | é›†æˆ Redis ä½œä¸ºç¼“å­˜æ”¯æŒ                            | âœ… å·²å®Œæˆ  |
| ğŸ“ æ—¥å¿—ç³»ç»Ÿ    | é›†æˆ zeroLog æ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒ Elasticsearch å’Œæ–‡ä»¶æ—¥å¿— | âœ… å·²å®Œæˆ  |
| ğŸ”„ ç¼“å­˜æŒ‡ä»¤    | æ·»åŠ  @cache æŒ‡ä»¤æ¥æ”¯æŒç¼“å­˜æŸ¥è¯¢ç»“æœ                  | ğŸš§ è¿›è¡Œä¸­  |
| ğŸ”€ æ’åºæŒ‡ä»¤    | æ·»åŠ  @order æŒ‡ä»¤æ¥æ”¯æŒå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº            | ğŸš§ è¿›è¡Œä¸­  |
| ğŸ—„ï¸ ORM æ”¯æŒ    | æ‰©å±•å¯¹å…¶ä»– ORM çš„æ”¯æŒï¼Œå¦‚ `ent`ã€`sqlc` ç­‰           | â³ è®¡åˆ’ä¸­  |
| ğŸ“‘ æ–‡æ¡£ç”Ÿæˆå·¥å…· | è‡ªåŠ¨åŒ–ç”Ÿæˆ GraphQL Schema æ–‡æ¡£                     | â³ è®¡åˆ’ä¸­  |
| ğŸ“¦ æ’ä»¶æ”¯æŒ    | æä¾›æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒç¤¾åŒºè´¡çŒ®å’ŒåŠŸèƒ½æ‰©å±•                 | â³ è®¡åˆ’ä¸­  |
| ğŸŒ å‰ç«¯å·¥å…·    | å¼€å‘ç±»ä¼¼ Apollo Studio çš„å‰ç«¯ï¼Œç”¨äºæŸ¥è¯¢ä¸æµ‹è¯•       | â³ è®¡åˆ’ä¸­  |
| ğŸ“Š æ€§èƒ½è¿½è¸ª    | æ”¯æŒæ¯ä¸ªå­—æ®µå’Œæ¯ä¸ªæœåŠ¡çš„æ€§èƒ½è¿½è¸ªï¼Œä»¥ä¼˜åŒ– GraphQL æŸ¥è¯¢æ€§èƒ½ | â³ è®¡åˆ’ä¸­  |

